# 魂游 MOD 翻译工具文档

> 文档是为 MOD 翻译者准备的，内部包含了较多的技术和使用细节，如果您只是想简单地机翻一个 MOD，那么您可以到此结束，请直接去看[这个视频](https://www.bilibili.com/video/BV17p421Q7qJ/)即可。

## 软件基本介绍

这一节将会从软件的原理、工作流等对软件进行基本介绍。

### 工作流

下图展示了软件的基本工作流。

简单来说，软件首先通过对照中英数据库的方式找到所有的新文本，紧接着基于额外的术语表对新文本做预处理（可选），然后将预处理后的中英夹杂的新文本导出为 Excel 或者 txt 格式。最后，软件将翻译者通过谷歌或人工翻译的方式翻译完成的新文本和之前产生的旧文本(已翻译)合并为新的语言文件并写入磁盘。

![](./images/workflow.drawio.svg)

### 文本和ID

为了方便标新文本的导入导出以及新旧文本的合并工作，软件在内部处理时候会为每一条文本分配一条唯一的ID（即导出的Excel和txt的每一行的第一列），因此，**在翻译导出文本时候请勿修改ID**。

### 中英对照数据库

中英对照数据库是软件提供的第一级翻译，即基于文本（包括段落和行）的对照和替换功能。具体来说，中英对照数据库是一个键值对集合,键是英文文本，值是对应的中文文本翻译。在翻译某个mod时，软件会遍历mod中的每一条英文文本，并在中英对照数据库中查询是否存在对应的翻译，如果存在则将改条标记为已翻译，不存在则标记为未翻译并导出。

软件提供了默认的原版数据库和自定义数据库的生成功能。**如果你的翻译目标是全新的mod，则使用软件提供的原版数据库即可，而如果你的需求是将旧版MOD的已有翻译合并到新版本中，那么你需要基于旧版本MOD的已有英文和中文文本生成自定义对照数据库。**软件在启动时会自动识别`db`目录下的所有对照数据库文件（即`json`），因此在使用自定义数据库时请将生成的对照数据库放置与db目录，并在导出未翻译文本时选中对应的数据库。

### 术语表




## 具体使用场景

TODO

## 技术细节


### 文本的切分和编号

对于 FS 游戏中的语言文件(.msgbnd.dcx 文件),其内部是树状组织的,一条完整的文本可以由`类型_ID`来表示，其中类型是 ASCII 字符串，如 WeaponName，WeaponCaption 等。ID 是一串长数字，标识了该条文本在其类型内的 ID。例如，"石剑钥匙"这一物品的文本描述为：

```
参考剑的外型设计的石制钥匙。

能解开小恶魔像的封印。
使用后会插在雕像上，从置物包消失。

建议慎选使用时机。
```

其文本类型是`GoodsCaption`,文本 ID 是 8000。

因此，翻译软件会根据这一索引为每一条文本设置基本的 UID。另外，为了尽量利用原版文本，软件还会在每条文本内部进行进一步的切分，即**为每条文本内的每一个段落和每一行分配各自的 ID**。还是以上述文本为例，下表列出了每一句话的 ID。

| 段落（句子）                                                  | 文本内 ID |
| ------------------------------------------------------------- | --------- |
| 参考剑的外型设计的石制钥匙。                                  | 1         |
| 能解开小恶魔像的封印。<br/>使用后会插在雕像上，从置物包消失。 | 2         |
| 能解开小恶魔像的封印。                                        | 21        |
| 使用后会插在雕像上，从置物包消失。                            | 22        |
| 建议慎选使用时机。                                            | 3         |

**段落被分配的 ID 永远是 1~9 之间的一个数字，而段落内每句话被分配的 ID 永远是 11~99 中间的一个数字（所有索引以 1 开头，不含整除 10 的数字）**，因此软件无法处理超过 9 段话的文本以及超过 9 行的句子。

句子的文本内 ID 和文本 ID"类型\_ID"一同构成了文本的唯一 ID。
